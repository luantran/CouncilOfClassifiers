services:
  - type: web
    name: council-of-classifiers
    runtime: python
    region: virginia
    plan: starter

    domains:
      - cefr-grader.com
      - www.cefr-grader.com

    # Build command - install dependencies and build frontend
    buildCommand: |
      pip install -r requirements.txt
      cd frontend
      npm install
      npm run build
      cd ..

    startCommand: python run.py

    envVars:
      - key: FLASK_ENV
        value: production

      - key: MODEL_CACHE_DIR
        value: /opt/render/project/server/hf_models

      - key: SECRET_KEY
        generateValue: true  # Render will auto-generate a secure secret

      # Optional: Add HuggingFace token if using private models
      # - key: HF_TOKEN
      #   sync: false  # Set this manually in Render dashboard

    autoDeploy: true

    healthCheckPath: /api/health

    disk:
      name: model-cache
      mountPath: /opt/render/project/server/hf_models
      sizeGB: 2